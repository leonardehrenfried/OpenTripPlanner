<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://docs.opentripplanner.org/1.5/Scripting/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Scripting - OpenTripPlanner</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../css/version-select.css" rel="stylesheet">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">OpenTripPlanner</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Governance/" class="dropdown-item">Governance</a>
</li>
                                    
<li>
    <a href="../History/" class="dropdown-item">History</a>
</li>
                                    
<li>
    <a href="../Deployments/" class="dropdown-item">Deployments</a>
</li>
                                    
<li>
    <a href="../Changelog/" class="dropdown-item">Changelog</a>
</li>
                                    
<li>
    <a href="../Visual-Identity/" class="dropdown-item">Visual Identity</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Basic-Tutorial/" class="dropdown-item">Basic Tutorial</a>
</li>
                                    
<li>
    <a href="../Intermediate-Tutorial/" class="dropdown-item">Intermediate Tutorial</a>
</li>
                                    
<li>
    <a href="../External-Tutorials/" class="dropdown-item">External Tutorials</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Usage Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Getting-OTP/" class="dropdown-item">Getting OTP</a>
</li>
                                    
<li>
    <a href="../Configuration/" class="dropdown-item">Configuration</a>
</li>
                                    
<li>
    <a href="../Analyst/" class="dropdown-item">Analyst</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Scripting</a>
</li>
                                    
<li>
    <a href="../Security/" class="dropdown-item">Security</a>
</li>
                                    
<li>
    <a href="../Troubleshooting-Routing/" class="dropdown-item">Troubleshooting</a>
</li>
                                    
<li>
    <a href="../Flex/" class="dropdown-item">GTFS-Flex Routing</a>
</li>
                                    
<li>
    <a href="../Surface/" class="dropdown-item">One-to-many Travel Times</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Development <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Developers-Guide/" class="dropdown-item">Developers' Guide</a>
</li>
                                    
<li>
    <a href="../Architecture/" class="dropdown-item">Architecture</a>
</li>
                                    
<li>
    <a href="../Localization/" class="dropdown-item">Localization</a>
</li>
                                    
<li>
    <a href="../Bibliography/" class="dropdown-item">Bibliography</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                            <li class="nav-item">
                                <a rel="prev" href="../Analyst/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../Security/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="http://github.com/opentripplanner/OpenTripPlanner/edit/master/docs/Scripting.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#scripting" class="nav-link">Scripting</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#introduction" class="nav-link">Introduction</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#usage" class="nav-link">Usage</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#script-tutorial" class="nav-link">Script tutorial</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#api" class="nav-link">API</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="scripting">Scripting</h1>
<h2 id="introduction">Introduction</h2>
<p>The aim of OTP scripting is to be able to use and automate OTP from within scripts.</p>
<p>The available languages right now are <em>Jython</em> and <em>Groovy</em>; Jython being the most tested and supported. All the examples in this page are using Python. OTP Scripting could easily support in the future any other language that supports BSF (Bean Scripting Framework), such as <em>Javascript</em> or <em>Ruby</em>.</p>
<p><strong>Note</strong>: Jython is a Python-flavor using a Java JVM as runtime. Python and Jython are mostly compatible.</p>
<h2 id="usage">Usage</h2>
<p>There are currently 3 different modes for using scripting:</p>
<ul>
<li>Launching OTP with the <code>--script</code> command-line parameter, providing the script filename as an option.</li>
<li>Starting an OTP server with the <code>--enableScriptingWebService</code> command-line parameter, and posting a script to execute to the <code>/ws/scripting/run</code> API end-point.</li>
<li>Launching a Jython script with <code>otp-x.y.z-shaded.jar</code> in the classpath and creating the scripting entry-point bean in the script itself.</li>
</ul>
<h3 id="launching-a-script-from-otp">Launching a script from OTP</h3>
<p>The main advantage of this method is its simplicity. The drawback is that you need to start OTP everytime you run a script, which can be slow to startup for large graphs. The second drawback is that you can't import custom packages from within the script, you are limited to the "plain basic" Jython.</p>
<p><strong>Note</strong>: The Jython (or Groovy) JAR are <em>not</em> included in the OTP shaded JAR. You thus have to add one of them (depending on your script) to the java classpath (see command below). Jython jar can be <a href="http://www.jython.org/downloads.html">downloaded here</a>. Make sure you select the "standalone" version of jython, otherwise some classes will be missing.</p>
<p><strong>Note</strong>: Due a guava bug, there is an incompatibility between Jython 2.3 / 2.5 and OTP. To solve it, make sure otp.jar is added <em>before</em> jython-standalone.jar in the classpath. This bug should be solved in jython starting 2.7.</p>
<p>Start OTP specifying the classpath and adding the <code>--script</code> option:</p>
<pre><code class="language-Bash">$ java -cp otp-x.y.z-shaded.jar:jython-standalone.jar org.opentripplanner.standalone.OTPMain --graphs . --script myscript.py
</code></pre>
<p>This will start OTP with a default graph in the current directory and execute the script <code>myscript.py</code>.</p>
<p>The return value of the script is discarded and printed to the log as a warning if the return value is not <code>null</code>.</p>
<h3 id="scripting-web-service">Scripting web-service</h3>
<p>The main advantage of this method is that you do not need to start a new OTP server (which can take some time for large graphs) each time you start a new script. This mode is well-adapted for script development and debugging. The drawback is about security: it is not advisable to use this method for public-facing servers.</p>
<p>Start an OTP server as usual, adding the <code>--enableScriptingWebService</code> option:</p>
<pre><code class="language-Bash">$ java -cp otp-x.y.z-shaded.jar:jython-standalone.jar org.opentripplanner.standalone.OTPMain --graphs . --server --enableScriptingWebService
</code></pre>
<p>The API end-point <code>/ws/scripting/run</code> now accepts script content to be run, posted as multi-part form data.</p>
<p>To post a script to be executed, you can use either:</p>
<ul>
<li>The online form at <code>http://host:8080/scripting.html</code>, where you can upload a localfile to the server;</li>
<li>Using <code>curl</code> from the command-line, such as:</li>
</ul>
<pre><code class="language-Bash">$ curl --form &quot;scriptfile=@myscript.py&quot; host:8080/otp/scripting/run
</code></pre>
<p>The return value of the script is passed as the return value of the web-service, in textual form. This can be used to return some value to the client (for example data in CSV form).</p>
<p>The standard output / error streams of the script (the place where the various <code>print</code> statements are printed)
is the standard output of the OTP server (the console where you start the OTP server).</p>
<p>The default location where files are loaded or saved is the working directory of the server, usually the directory from where you started the OTP server.</p>
<p><em>Warning</em>: Enable this web-service on public-facing server is rather dangerous as this will open a whole range of exploits on the application.</p>
<h3 id="using-otp-as-a-library">Using OTP as a library</h3>
<p>The advantage of this method is its versatility. You can import any custom library in your script, and you are free to create the OTP server instance when you need it. The drawback is that you need to have an external Jython interpreter installed, and you need to startup OTP yourself within the script (2 lines of code, see below).</p>
<p>Example of use using python:</p>
<pre><code class="language-Python">#!/usr/bin/jython
from org.opentripplanner.scripting.api import *
otp = OtpsEntryPoint.fromArgs([ &quot;--graphs&quot;, &quot;/path/to/graphs&quot;, &quot;--router&quot;, &quot;amsterdam&quot; ])
# ... the rest of your script goes here ...
</code></pre>
<pre><code class="language-Bash">$ java -cp otp-x.y.z-shaded.jar:jython-standalone.jar org.python.util.jython myscript.py
</code></pre>
<p>Or, simpler:</p>
<pre><code class="language-Bash">$ jython -Dpython.path=otp-x.y.z-shaded.jar myscript.py
</code></pre>
<p>Note that contrary to java custom the jython "main" class is all lowercase, this is not a typo.</p>
<h2 id="script-tutorial">Script tutorial</h2>
<p>For a simple but functional example, please see <a href="https://github.com/opentripplanner/OpenTripPlanner/blob/master/src/test/resources/scripts/test.py">this script</a>.
With the embedded comments it should be self-explanatory.
In order to use this demo in the "library" mode, insert the 3 python lines given in the previous section at the beginning of the script.</p>
<h2 id="api">API</h2>
<p>For a complete documentation, please see the <a href="http://dev.opentripplanner.org/javadoc/">online JavaDoc</a> of all classes within the <code>org.opentripplanner.scripting.api</code> package.</p>
<p>Classes in this package are meant to be kept stable in time, at least regarding backward compatibility. Be careful as scripting is still in development phase; so there is no strong guarantee about the stability of the API, which is only a stated long-term goal. The aim is to achieve a stable API for the 1.0 OTP release.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../js/version-select.js" defer></script>

        <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
