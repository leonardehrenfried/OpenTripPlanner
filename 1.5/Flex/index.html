<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://docs.opentripplanner.org/1.5/Flex/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>GTFS-Flex Routing - OpenTripPlanner</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../css/version-select.css" rel="stylesheet">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">OpenTripPlanner</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Governance/" class="dropdown-item">Governance</a>
</li>
                                    
<li>
    <a href="../History/" class="dropdown-item">History</a>
</li>
                                    
<li>
    <a href="../Deployments/" class="dropdown-item">Deployments</a>
</li>
                                    
<li>
    <a href="../Changelog/" class="dropdown-item">Changelog</a>
</li>
                                    
<li>
    <a href="../Visual-Identity/" class="dropdown-item">Visual Identity</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Basic-Tutorial/" class="dropdown-item">Basic Tutorial</a>
</li>
                                    
<li>
    <a href="../Intermediate-Tutorial/" class="dropdown-item">Intermediate Tutorial</a>
</li>
                                    
<li>
    <a href="../External-Tutorials/" class="dropdown-item">External Tutorials</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Usage Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Getting-OTP/" class="dropdown-item">Getting OTP</a>
</li>
                                    
<li>
    <a href="../Configuration/" class="dropdown-item">Configuration</a>
</li>
                                    
<li>
    <a href="../Analyst/" class="dropdown-item">Analyst</a>
</li>
                                    
<li>
    <a href="../Scripting/" class="dropdown-item">Scripting</a>
</li>
                                    
<li>
    <a href="../Security/" class="dropdown-item">Security</a>
</li>
                                    
<li>
    <a href="../Troubleshooting-Routing/" class="dropdown-item">Troubleshooting</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">GTFS-Flex Routing</a>
</li>
                                    
<li>
    <a href="../Surface/" class="dropdown-item">One-to-many Travel Times</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Development <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Developers-Guide/" class="dropdown-item">Developers' Guide</a>
</li>
                                    
<li>
    <a href="../Architecture/" class="dropdown-item">Architecture</a>
</li>
                                    
<li>
    <a href="../Localization/" class="dropdown-item">Localization</a>
</li>
                                    
<li>
    <a href="../Bibliography/" class="dropdown-item">Bibliography</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                            <li class="nav-item">
                                <a rel="prev" href="../Troubleshooting-Routing/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../Surface/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="http://github.com/opentripplanner/OpenTripPlanner/edit/master/docs/Flex.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#gtfs-flex-routing" class="nav-link">GTFS-Flex routing</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#configuration" class="nav-link">Configuration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#implementation" class="nav-link">Implementation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="gtfs-flex-routing">GTFS-Flex routing</h1>
<p>Many agencies run flexible services to complement their fixed-route service. "Flexible" service does
not follow a strict timetable or route. It may include any of the following features: boardings
or alightings outside its scheduled timetable and route; booking and scheduling in advance; or
transit parameters which depend on customer requests ("demand-responsive transit" or DRT). These
services are typically used in rural areas or for mobility-impaired riders.</p>
<p>A GTFS extension called <a href="https://github.com/MobilityData/gtfs-flex/blob/master/spec/reference.md">GTFS-Flex</a> defines
how to model some kinds of flexible transit. A subset of GTFS-Flex has been implemented in 
OpenTripPlanner as part of US DOT's <a href="https://www.transit.dot.gov/research-innovation/fiscal-year-2016-mobility-demand-mod-sandbox-program-projects">Mobility-on-Demand Sandbox Grant</a>.</p>
<p>In particular, OTP now has support for these modes of GTFS-Flex:</p>
<ul>
<li>"flag stops", in which a passenger can flag down the a vehicle along its route to board, or
alight in between stops</li>
<li>"deviated-route service", in which a vehicle can deviate from its route within an area or radius to
do a dropoff or pickup</li>
<li>"call-and-ride", which is an entirely deviated, point-to-point segment.</li>
</ul>
<p>These modes can co-exist with fixed-route transit, and with each other. For example, some agencies 
have fixed-route services that start in urban areas, where passengers must board at designated
stops, but end in rural areas where passengers can board and alight wherever they please. A
fixed-route service may terminate in an defined area where it can drop off passengers anywhere --
or have such an area at the beginning or middle of its route. A vehicle may be able to deviate a
certain radius outside its scheduled route to pick up or drop off passengers. If both a pickup and
dropoff occur in between scheduled timepoints, from the passenger's perspective, the service may
look like a call-and-ride trip. Other call-and-ride services may operate more like taxis, in which
all rides are independently scheduled.</p>
<h2 id="configuration">Configuration</h2>
<p>In order to use flexible routing, an OTP graph must be built with a GTFS-Flex dataset and
OpenStreetMap data. The GTFS data must include <code>shapes.txt</code>.</p>
<p>In addition, the parameter <code>useFlexService: true</code> must be added to <code>router-config.json</code>.</p>
<p>A number of routing parameters can be used to control aspects of flexible service. These parameters
typically change the relative cost of using various flexible services relative to fixed-route
transit. All flex-related parameters begin with the prefix "flex" and can be found in the Javadocs
for <code>RoutingRequest.java</code>.</p>
<p>The following example <code>router-config.json</code> enables flexible routing and sets some parameters:</p>
<pre><code>{
  "useFlexService": true,
  "routingDefaults": {
    "flexCallAndRideReluctance": 3,
    "flexMaxCallAndRideSeconds": 7200,
    "flexFlagStopExtraPenalty": 180
  }
}
</code></pre>
<h2 id="implementation">Implementation</h2>
<p>The general approach of the GTFS-Flex implementation is as follows: prior to the main graph search,
special searches are run around the origin and destination to discover possible flexible options.
One search is with the WALK mode, to find flag stops, and the other is in the CAR mode, to find
deviated-route and call-and-ride options. These searches result in the creation of temporary, 
request-specific vertices and edges. Then, the graph search proceeds as normal. Temporary graph
structures are disposed at the end of the request's lifecycle.</p>
<p>For flag stops and deviated-route service, timepoints in between scheduled locations are determined
via linear interpolation. For example, say a particular trip departs stop A at 9:00am and arrives
at stop B at 9:30am. A passenger would be able to board 20% of the way in between stop A and stop B
at 9:06am, since 20% of 30 minutes is 6 minutes.</p>
<p>For deviated-route service and call-and-ride service, the most pessimistic assumptions of vehicle
travel time are used -- e.g. vehicle travel time is calculated via the <code>drt_max_travel_time</code>
formula in the GTFS-Flex (see the spec <a href="https://github.com/MobilityData/gtfs-flex/blob/master/spec/reference.md#defining-service-parameters">here</a>).</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../js/version-select.js" defer></script>

        <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
